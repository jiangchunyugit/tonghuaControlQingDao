<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.thinkfree.database.mapper.PcUserInfoMapper">
    <resultMap id="ResultMap" type="cn.thinkfree.database.vo.PcUserInfoVo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="phone" jdbcType="VARCHAR" property="phone" />
        <result column="memo" jdbcType="VARCHAR" property="memo" />
        <result column="creator" jdbcType="VARCHAR" property="creator" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="enabled" jdbcType="SMALLINT" property="enabled" />
        <result column="is_delete" jdbcType="SMALLINT" property="isDelete" />
        <result column="company_id" jdbcType="VARCHAR" property="companyId" />
        <result column="root_company_id" jdbcType="VARCHAR" property="rootCompanyId" />
        <result column="parent_company_id" jdbcType="VARCHAR" property="parentCompanyId" />
        <result column="level" jdbcType="SMALLINT" property="level" />
        <result column="province" jdbcType="VARCHAR" property="province" />
        <result column="city" jdbcType="VARCHAR" property="city" />
        <result column="area" jdbcType="VARCHAR" property="area" />
        <result column="login_time" jdbcType="TIMESTAMP" property="lastLogin" />
        <result column="password" jdbcType="VARCHAR" property="password" />
        <result column="company_name" jdbcType="TIMESTAMP" property="companyName" />
    </resultMap>

    <sql id="Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, name, phone, memo, creator, create_time, enabled, is_delete, company_id, root_company_id,
        parent_company_id, level, province, city, area, password, company_name,login_time
    </sql>


    <select id="selectByParam" parameterType="java.util.List" resultMap="ResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List" />
        from pc_user_info
        where 1=1
        <if test="list != null">
            and company_id in <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
                                    #{item}
                                </foreach>
        </if>
    </select>

    <!--select pc.*,log.login_time from pc_user_info pc
    left join (select phone, max(login_time) login_time from user_login_log group by phone) log
    on pc.phone = log.phone
    level =3 and root_companny_id = x and city
    -->

    <select id="findByParam" parameterType="java.util.Map" resultMap="ResultMap">
        select pc.*,log.login_time from pc_user_info pc
            left join (select phone, max(login_time) login_time from user_login_log
            group by phone) log on pc.phone = log.phone where 1=1
        <if test="param != null and param != ''">
            and (pc.name like #{param} or pc.phone like #{param})
        </if>
        <if test="companyId != null">
            and pc.company_id in <foreach item="item" index="index" collection="companyId" open="(" separator="," close=")">
            #{item}
        </foreach>
        </if>
    </select>
    <!--select users.*, com.company_name from company_info com join (select pc.*, re.password
    from pc_user_info pc join user_register re on pc.id = re.user_id and pc.id = 'PC20180815') users
    on com.company_id = users.company_id-->
    <select id="findByUserId" parameterType="java.lang.String" resultMap="ResultMap">
        select users.*, com.company_name from company_info com
        join (select pc.*, re.password
        from pc_user_info pc join user_register re on pc.id = re.user_id and pc.id = #{userId,jdbcType=VARCHAR}) users
        on com.company_id = users.company_id
    </select>

    <update id="updateById" parameterType="cn.thinkfree.database.vo.PcUserInfoVo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update pc_user_info
        <set>
            <if test="name != null">
                name = #{name,jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                phone = #{phone,jdbcType=VARCHAR},
            </if>
            <if test="memo != null">
                memo = #{memo,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                creator = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null">
                enabled = #{enabled,jdbcType=SMALLINT},
            </if>
            <if test="isDelete != null">
                is_delete = #{isDelete,jdbcType=SMALLINT},
            </if>
            <if test="companyId != null">
                company_id = #{companyId,jdbcType=VARCHAR},
            </if>
            <if test="rootCompanyId != null">
                root_company_id = #{rootCompanyId,jdbcType=VARCHAR},
            </if>
            <if test="parentCompanyId != null">
                parent_company_id = #{parentCompanyId,jdbcType=VARCHAR},
            </if>
            <if test="level != null">
                level = #{level,jdbcType=SMALLINT},
            </if>
            <if test="province != null">
                province = #{province,jdbcType=VARCHAR},
            </if>
            <if test="city != null">
                city = #{city,jdbcType=VARCHAR},
            </if>
            <if test="area != null">
                area = #{area,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <insert id="insertUserInfoVo" parameterType="cn.thinkfree.database.vo.PcUserInfoVo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into pc_user_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="phone != null">
                phone,
            </if>
            <if test="memo != null">
                memo,
            </if>
            <if test="creator != null">
                creator,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="enabled != null">
                enabled,
            </if>
            <if test="isDelete != null">
                is_delete,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="rootCompanyId != null">
                root_company_id,
            </if>
            <if test="parentCompanyId != null">
                parent_company_id,
            </if>
            <if test="level != null">
                level,
            </if>
            <if test="province != null">
                province,
            </if>
            <if test="city != null">
                city,
            </if>
            <if test="area != null">
                area,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="name != null">
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="phone != null">
                #{phone,jdbcType=VARCHAR},
            </if>
            <if test="memo != null">
                #{memo,jdbcType=VARCHAR},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null">
                #{enabled,jdbcType=SMALLINT},
            </if>
            <if test="isDelete != null">
                #{isDelete,jdbcType=SMALLINT},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=VARCHAR},
            </if>
            <if test="rootCompanyId != null">
                #{rootCompanyId,jdbcType=VARCHAR},
            </if>
            <if test="parentCompanyId != null">
                #{parentCompanyId,jdbcType=VARCHAR},
            </if>
            <if test="level != null">
                #{level,jdbcType=SMALLINT},
            </if>
            <if test="province != null">
                #{province,jdbcType=VARCHAR},
            </if>
            <if test="city != null">
                #{city,jdbcType=VARCHAR},
            </if>
            <if test="area != null">
                #{area,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
</mapper>