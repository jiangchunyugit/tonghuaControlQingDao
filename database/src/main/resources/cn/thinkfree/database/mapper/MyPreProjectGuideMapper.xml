<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.thinkfree.database.mapper.PreProjectGuideMapper">
    <resultMap id="ProjectVO" type="cn.thinkfree.database.vo.ProjectVO" extends="BaseResultMap">
        <result column="stewardName" property="stewardName"/>
        <result column="projectManagerName" property="projectManagerName"/>

        <association property="preProjectInfo" javaType="cn.thinkfree.database.model.PreProjectInfo">
            <result column="house_area" property="houseArea"/>
            <result column="house_type" property="houseType"/>
            <result column="store" property="store"/>
        </association>

    </resultMap>

    <resultMap id="ProjectDetailsVO" type="cn.thinkfree.database.vo.ProjectDetailsVO" extends="BaseResultMap">

        <association property="info" column="project_no"   javaType="cn.thinkfree.database.model.PreProjectInfo"
                     select="cn.thinkfree.database.mapper.PreProjectInfoMapper.selectProjectInfoByProjectNo"/>

    </resultMap>

  <select id="selectProjectVOBySEO" parameterType="cn.thinkfree.database.vo.ProjectSEO" resultMap="ProjectVO">
        SELECT
            ppg.project_no,
            ppg.project_name,
            ppg.province,
            ppg.city,
            ppg.area,
            ppg.customer_name,
            ppg.customer_phone,
            ppi.house_area,
            ppi.house_type,
            ppi.store,
            ppg.status,
          (SELECT user_name FROM pre_project_user_role where project_no = ppg.project_no and role_id = '管家') as stewardName,
          (SELECT user_name FROM pre_project_user_role where project_no = ppg.project_no and role_id = '项目经理') as projectManagerName
        FROM
          pre_project_guide ppg
        JOIN pre_project_company_set ppcs ON ppg.project_no = ppcs.project_no
        JOIN pre_project_info ppi ON ppi.project_no = ppg.project_no

        <where>
           and ppg.is_delete = 0
           and ppcs.company_id in
            <foreach close=")" collection="companyRelationMap" item="listItem" open="(" separator=",">
                #{listItem}
            </foreach>
          <if test="provice != null and provice != ''">
              and ppg.province = #{provice}
          </if>
          <if test="city != null and city != ''">
            and ppg.city = #{city}
          </if>
          <if test="area != null and area != ''">
            and ppg.area = #{area}
          </if>
          <if test="staus != null and staus != ''">
            and ppg.staus = #{staus}
          </if>
          <if test="hall != null and hall != ''">
            and ppg.hall = #{hall}
          </if>
          <if test="customName != null and customName != ''">
            and ppg.customName = #{customName}
          </if>
          <if test="filterProjectNos != null and filterProjectNos.size > 0">
            and ppg.project_no in
              <foreach close=")" collection="filterProjectNos" item="listItem" open="(" separator=",">
                  #{listItem}
              </foreach>
          </if>

        </where>


    </select>


    <select id="selectProjectDetailsByProjectNo" parameterType="java.lang.String" resultMap="ProjectDetailsVO">
      select
        <include refid="Base_Column_List" />
      from
      pre_project_guide
      where   project_no = #{projectNo}

    </select>


</mapper>